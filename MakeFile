# =========================
# Makefile for EDLines Study Project
# =========================

# Variables
BUILD_DIR := build
EDLIB_DIR := ED_Lib
IMAGES_DIR := images
MAIN_EXE := $(BUILD_DIR)/test_ED
SUB_EXE := $(EDLIB_DIR)/test_ED

# Default target
.PHONY: all
all: init build

# -------------------------
# ğŸ”¹ Initialize repository
# -------------------------
.PHONY: init
init:
	@echo "ğŸ“¦ Initializing submodules..."
	git submodule update --init --recursive

# -------------------------
# ğŸ”¹ Build both projects
# -------------------------
.PHONY: build
build: build-main build-edlib

build-main:
	@echo "ğŸ”¨ Building main project..."
	@mkdir -p $(BUILD_DIR)
	cd $(BUILD_DIR) && cmake .. && $(MAKE)

build-edlib:
	@echo "ğŸ”¨ Building EDLib submodule..."
	cd $(EDLIB_DIR) && mkdir -p build && cd build && cmake .. && $(MAKE)

# -------------------------
# ğŸ”¹ Run both tests
# -------------------------
.PHONY: run
run: run-main run-edlib

run-main:
	@echo "ğŸš€ Running test_ED from main project..."
	@if [ -f $(MAIN_EXE) ]; then \
		for img in $(IMAGES_DIR)/*; do \
			echo "â–¶ï¸ Running with $$img"; \
			$(MAIN_EXE) $$img; \
		done \
	else \
		echo "âŒ Executable $(MAIN_EXE) not found. Run 'make build' first."; \
	fi

run-edlib:
	@echo "ğŸš€ Running test_ED from ED_Lib submodule..."
	@if [ -f $(SUB_EXE) ]; then \
		for img in $(IMAGES_DIR)/*; do \
			echo "â–¶ï¸ Running with $$img"; \
			$(SUB_EXE) $$img; \
		done \
	else \
		echo "âŒ Executable $(SUB_EXE) not found. Run 'make build' first."; \
	fi

# -------------------------
# ğŸ”¹ Clean builds
# -------------------------
.PHONY: clean
clean:
	@echo "ğŸ§¹ Cleaning all build files..."
	rm -rf $(BUILD_DIR)
	rm -rf $(EDLIB_DIR)/build

# -------------------------
# ğŸ”¹ Full rebuild
# -------------------------
.PHONY: rebuild
rebuild: clean all

